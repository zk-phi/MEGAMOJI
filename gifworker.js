(()=>{var t={5958:(t,e)=>{var r=Object.defineProperty;r(e,"__esModule",{value:!0}),((t,e)=>{for(var n in e)r(t,n,{get:e[n],enumerable:!0})})(e,{GIFEncoder:()=>C,applyPalette:()=>m,default:()=>q,nearestColor:()=>U,nearestColorIndex:()=>k,nearestColorIndexWithDistance:()=>x,prequantize:()=>p,quantize:()=>y,snapColorsToPalette:()=>v});var n={signature:"GIF",version:"89a",trailer:59,extensionIntroducer:33,applicationExtensionLabel:255,graphicControlExtensionLabel:249,imageSeparator:44,signatureSize:3,versionSize:3,globalColorTableFlagMask:128,colorResolutionMask:112,sortFlagMask:8,globalColorTableSizeMask:7,applicationIdentifierSize:8,applicationAuthCodeSize:3,disposalMethodMask:28,userInputFlagMask:2,transparentColorFlagMask:1,localColorTableFlagMask:128,interlaceFlagMask:64,idSortFlagMask:32,localColorTableSizeMask:7};function a(t=256){let e=0,r=new Uint8Array(t);return{get buffer(){return r.buffer},reset(){e=0},bytesView:()=>r.subarray(0,e),bytes:()=>r.slice(0,e),writeByte(t){n(e+1),r[e]=t,e++},writeBytes(t,a=0,o=t.length){n(e+o);for(let n=0;n<o;n++)r[e++]=t[n+a]},writeBytesView(t,a=0,o=t.byteLength){n(e+o),r.set(t.subarray(a,a+o),e),e+=o}};function n(t){var n=r.length;if(n>=t)return;t=Math.max(t,n*(n<1048576?2:1.125)>>>0),0!=n&&(t=Math.max(t,256));const a=r;r=new Uint8Array(t),e>0&&r.set(a.subarray(0,e),0)}}var o=12,i=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],l=function(t,e,r,n,l=a(512),c=new Uint8Array(256),s=new Int32Array(5003),f=new Int32Array(5003)){const u=s.length,w=Math.max(2,n);c.fill(0),f.fill(0),s.fill(-1);let h=0,y=0;const g=w+1,b=g;let d=!1,p=b,m=(1<<p)-1;const B=1<<g-1,A=B+1;let v=B+2,M=0,k=r[0],x=0;for(let t=u;t<65536;t*=2)++x;x=8-x,l.writeByte(w),C(B);const U=r.length;for(let t=1;t<U;t++)t:{const e=r[t],n=(e<<o)+k;let a=e<<x^k;if(s[a]===n){k=f[a];break t}const i=0===a?1:u-a;for(;s[a]>=0;)if(a-=i,a<0&&(a+=u),s[a]===n){k=f[a];break t}C(k),k=e,v<1<<o?(f[a]=v++,s[a]=n):(s.fill(-1),v=B+2,d=!0,C(B))}return C(k),C(A),l.writeByte(0),l.bytesView();function C(t){for(h&=i[y],y>0?h|=t<<y:h=t,y+=p;y>=8;)c[M++]=255&h,M>=254&&(l.writeByte(M),l.writeBytesView(c,0,M),M=0),h>>=8,y-=8;if((v>m||d)&&(d?(p=b,m=(1<<p)-1,d=!1):(++p,m=p===o?1<<p:(1<<p)-1)),t==A){for(;y>0;)c[M++]=255&h,M>=254&&(l.writeByte(M),l.writeBytesView(c,0,M),M=0),h>>=8,y-=8;M>0&&(l.writeByte(M),l.writeBytesView(c,0,M),M=0)}}};function c(t,e,r){return t<<8&63488|e<<2&992|r>>3}function s(t,e,r,n){return t>>4|240&e|(240&r)<<4|(240&n)<<8}function f(t,e,r){return t>>4<<8|240&e|r>>4}function u(t,e,r){return t<e?e:t>r?r:t}function w(t){return t*t}function h(t,e,r){var n=0,a=1e100;const o=t[e],i=o.cnt,l=o.ac,c=o.rc,s=o.gc,f=o.bc;for(var u=o.fw;0!=u;u=t[u].fw){const e=t[u],o=e.cnt,y=i*o/(i+o);if(!(y>=a)){var h=0;r&&(h+=y*w(e.ac-l))>=a||(h+=y*w(e.rc-c))>=a||(h+=y*w(e.gc-s))>=a||(h+=y*w(e.bc-f))>=a||(a=h,n=u)}}o.err=a,o.nn=n}function y(t,e,r={}){const{format:n="rgb565",clearAlpha:a=!0,clearAlphaColor:o=0,clearAlphaThreshold:i=0,oneBitAlpha:l=!1}=r;if(!t||!t.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(t instanceof Uint8Array||t instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");const y=new Uint32Array(t.buffer);let b=!1!==r.useSqrt;const d="rgba4444"===n,p=function(t,e){const r=new Array("rgb444"===e?4096:65536),n=t.length;if("rgba4444"===e)for(let e=0;e<n;++e){const n=t[e],a=n>>24&255,o=n>>16&255,i=n>>8&255,l=255&n,c=s(l,i,o,a);let f=c in r?r[c]:r[c]={ac:0,rc:0,gc:0,bc:0,cnt:0,nn:0,fw:0,bk:0,tm:0,mtm:0,err:0};f.rc+=l,f.gc+=i,f.bc+=o,f.ac+=a,f.cnt++}else if("rgb444"===e)for(let e=0;e<n;++e){const n=t[e],a=n>>16&255,o=n>>8&255,i=255&n,l=f(i,o,a);let c=l in r?r[l]:r[l]={ac:0,rc:0,gc:0,bc:0,cnt:0,nn:0,fw:0,bk:0,tm:0,mtm:0,err:0};c.rc+=i,c.gc+=o,c.bc+=a,c.cnt++}else for(let e=0;e<n;++e){const n=t[e],a=n>>16&255,o=n>>8&255,i=255&n,l=c(i,o,a);let s=l in r?r[l]:r[l]={ac:0,rc:0,gc:0,bc:0,cnt:0,nn:0,fw:0,bk:0,tm:0,mtm:0,err:0};s.rc+=i,s.gc+=o,s.bc+=a,s.cnt++}return r}(y,n),m=p.length,B=m-1,A=new Uint32Array(m+1);for(var v=0,M=0;M<m;++M){const t=p[M];if(null!=t){var k=1/t.cnt;d&&(t.ac*=k),t.rc*=k,t.gc*=k,t.bc*=k,p[v++]=t}}var x,U,C;for(w(e)/v<.022&&(b=!1),M=0;M<v-1;++M)p[M].fw=M+1,p[M+1].bk=M,b&&(p[M].cnt=Math.sqrt(p[M].cnt));for(b&&(p[M].cnt=Math.sqrt(p[M].cnt)),M=0;M<v;++M){h(p,M,!1);var F=p[M].err;for(U=++A[0];U>1&&!(p[x=A[C=U>>1]].err<=F);U=C)A[U]=x;A[U]=M}var I=v-e;for(M=0;M<I;){for(var z;;){var E=A[1];if((z=p[E]).tm>=z.mtm&&p[z.nn].mtm<=z.tm)break;for(z.mtm==B?E=A[1]=A[A[0]--]:(h(p,E,!1),z.tm=M),F=p[E].err,U=1;(C=U+U)<=A[0]&&(C<A[0]&&p[A[C]].err>p[A[C+1]].err&&C++,!(F<=p[x=A[C]].err));U=C)A[U]=x;A[U]=E}var q=p[z.nn],S=z.cnt,G=q.cnt;k=1/(S+G),d&&(z.ac=k*(S*z.ac+G*q.ac)),z.rc=k*(S*z.rc+G*q.rc),z.gc=k*(S*z.gc+G*q.gc),z.bc=k*(S*z.bc+G*q.bc),z.cnt+=q.cnt,z.mtm=++M,p[q.bk].fw=q.fw,p[q.fw].bk=q.bk,q.mtm=B}let V=[];var T=0;for(M=0;;++T){let t=u(Math.round(p[M].rc),0,255),e=u(Math.round(p[M].gc),0,255),r=u(Math.round(p[M].bc),0,255),n=255;d&&(n=u(Math.round(p[M].ac),0,255),l&&(n=n<=("number"==typeof l?l:127)?0:255),a&&n<=i&&(t=e=r=o,n=0));const c=d?[t,e,r,n]:[t,e,r];if(g(V,c)||V.push(c),0==(M=p[M].fw))break}return V}function g(t,e){for(let r=0;r<t.length;r++){const n=t[r];let a=n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2],o=!(n.length>=4&&e.length>=4)||n[3]===e[3];if(a&&o)return!0}return!1}function b(t,e){var r,n=0;for(r=0;r<t.length;r++){const a=t[r]-e[r];n+=a*a}return n}function d(t,e){return e>1?Math.round(t/e)*e:t}function p(t,{roundRGB:e=5,roundAlpha:r=10,oneBitAlpha:n=null}={}){const a=new Uint32Array(t.buffer);for(let t=0;t<a.length;t++){const o=a[t];let i=o>>24&255,l=o>>16&255,c=o>>8&255,s=255&o;i=d(i,r),n&&(i=i<=("number"==typeof n?n:127)?0:255),s=d(s,e),c=d(c,e),l=d(l,e),a[t]=i<<24|l<<16|c<<8|s<<0}}function m(t,e,r="rgb565"){if(!t||!t.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(t instanceof Uint8Array||t instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");if(e.length>256)throw new Error("applyPalette() only works with 256 colors or less");const n=new Uint32Array(t.buffer),a=n.length,o="rgb444"===r?4096:65536,i=new Uint8Array(a),l=new Array(o);if("rgba4444"===r)for(let t=0;t<a;t++){const r=n[t],a=r>>24&255,o=r>>16&255,c=r>>8&255,f=255&r,u=s(f,c,o,a),w=u in l?l[u]:l[u]=B(f,c,o,a,e);i[t]=w}else{const t="rgb444"===r?f:c;for(let r=0;r<a;r++){const a=n[r],o=a>>16&255,c=a>>8&255,s=255&a,f=t(s,c,o),u=f in l?l[f]:l[f]=A(s,c,o,e);i[r]=u}}return i}function B(t,e,r,n,a){let o=0,i=1e100;for(let l=0;l<a.length;l++){const c=a[l];let s=M(c[3]-n);s>i||(s+=M(c[0]-t),s>i||(s+=M(c[1]-e),s>i||(s+=M(c[2]-r),s>i||(i=s,o=l))))}return o}function A(t,e,r,n){let a=0,o=1e100;for(let i=0;i<n.length;i++){const l=n[i];let c=M(l[0]-t);c>o||(c+=M(l[1]-e),c>o||(c+=M(l[2]-r),c>o||(o=c,a=i)))}return a}function v(t,e,r=5){if(!t.length||!e.length)return;const n=t.map((t=>t.slice(0,3))),a=r*r,o=t[0].length;for(let r=0;r<e.length;r++){let i=e[r];i=i.length<o?[i[0],i[1],i[2],255]:i.length>o?i.slice(0,3):i.slice();const l=x(n,i.slice(0,3),b),c=l[0],s=l[1];s>0&&s<=a&&(t[c]=i)}}function M(t){return t*t}function k(t,e,r=b){let n=1/0,a=-1;for(let o=0;o<t.length;o++){const i=r(e,t[o]);i<n&&(n=i,a=o)}return a}function x(t,e,r=b){let n=1/0,a=-1;for(let o=0;o<t.length;o++){const i=r(e,t[o]);i<n&&(n=i,a=o)}return[a,n]}function U(t,e,r=b){return t[k(t,e,r)]}function C(t={}){const{initialCapacity:e=4096,auto:r=!0}=t,o=a(e),i=new Uint8Array(256),c=new Int32Array(5003),s=new Int32Array(5003);let f=!1;return{reset(){o.reset(),f=!1},finish(){o.writeByte(n.trailer)},bytes:()=>o.bytes(),bytesView:()=>o.bytesView(),get buffer(){return o.buffer},get stream(){return o},writeHeader:u,writeFrame(t,e,n,a={}){const{transparent:w=!1,transparentIndex:h=0,delay:y=0,palette:g=null,repeat:b=0,colorDepth:d=8,dispose:p=-1}=a;let m=!1;if(r?f||(m=!0,u(),f=!0):m=Boolean(a.first),e=Math.max(0,Math.floor(e)),n=Math.max(0,Math.floor(n)),m){if(!g)throw new Error("First frame must include a { palette } option");!function(t,e,r,n,a=8){const o=128|a-1<<4|E(n.length)-1;I(t,e),I(t,r),t.writeBytes([o,0,0])}(o,e,n,g,d),F(o,g),b>=0&&function(t,e){t.writeByte(33),t.writeByte(255),t.writeByte(11),z(t,"NETSCAPE2.0"),t.writeByte(3),t.writeByte(1),I(t,e),t.writeByte(0)}(o,b)}const B=Math.round(y/10);!function(t,e,r,n,a){var o,i;t.writeByte(33),t.writeByte(249),t.writeByte(4),a<0&&(a=0,n=!1),n?(o=1,i=2):(o=0,i=0),e>=0&&(i=7&e),i<<=2;t.writeByte(0|i|o),I(t,r),t.writeByte(a||0),t.writeByte(0)}(o,p,B,w,h);const A=Boolean(g)&&!m;!function(t,e,r,n){if(t.writeByte(44),I(t,0),I(t,0),I(t,e),I(t,r),n){const e=0,r=0,a=E(n.length)-1;t.writeByte(128|e|r|0|a)}else t.writeByte(0)}(o,e,n,A?g:null),A&&F(o,g),function(t,e,r,n,a=8,o,i,c){l(r,n,e,a,t,o,i,c)}(o,t,e,n,d,i,c,s)}};function u(){z(o,"GIF89a")}}function F(t,e){const r=1<<E(e.length);for(let n=0;n<r;n++){let r=[0,0,0];n<e.length&&(r=e[n]),t.writeByte(r[0]),t.writeByte(r[1]),t.writeByte(r[2])}}function I(t,e){t.writeByte(255&e),t.writeByte(e>>8&255)}function z(t,e){for(var r=0;r<e.length;r++)t.writeByte(e.charCodeAt(r))}function E(t){return Math.max(Math.ceil(Math.log2(t)),1)}var q=C}},e={};function r(n){var a=e[n];if(void 0!==a)return a.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,r),o.exports}(()=>{"use strict";var t=r(5958);const e=self,n=(0,t.GIFEncoder)(),a=[];let o;e.addEventListener("message",(r=>{if(r.data.initialize)o=r.data.initialize;else if(r.data.addFrame)a.push(r.data.addFrame);else if(r.data.finish){const{delay:r,transparent:i,width:l,height:c}=o,s=(()=>{const{width:e,height:r}=o,n=new Uint8Array(a.length*e*r*4);return a.forEach(((t,a)=>{n.set(t,a*e*r*4)})),(0,t.quantize)(n,256,{format:"rgb565"})})();i&&256===s.length&&s.pop();const f=(e=>{const r={};return n=>{const a=n[0]<<16|n[1]<<8|n[2];return void 0===r[a]&&(r[a]=(0,t.nearestColorIndex)(e,n)),r[a]}})(s),u=s.length;a.forEach(((t,e)=>{i&&((t,e,r)=>{var n,a;const o=new Array(e*r).fill(0);for(let i=0;i<r;i+=1)if(i%2==0)for(let a=0;a<e;a+=1){const l=i*e+a,c=t[4*l+3]+(null!==(n=o[l])&&void 0!==n?n:0);let s=0;c<128?(t[4*l+0]=0,t[4*l+1]=0,t[4*l+2]=0,t[4*l+3]=0,s=c):(t[4*l+3]=255,s=c-255),a+1<e&&(o[i*e+(a+1)]+=7*s/16),i+1<r&&(a-1>=0&&(o[(i+1)*e+(a-1)]+=3*s/16),o[(i+1)*e+a]+=5*s/16,a+1<e&&(o[(i+1)*e+(a+1)]+=1*s/16))}else for(let n=e-1;n>=0;n-=1){const l=i*e+n,c=t[4*l+3]+(null!==(a=o[l])&&void 0!==a?a:0);let s=0;c<128?(t[4*l+0]=0,t[4*l+1]=0,t[4*l+2]=0,t[4*l+3]=0,s=c):(t[4*l+3]=255,s=c-255),n-1>=0&&(o[i*e+(n-1)]+=7*s/16),i+1<r&&(n+1<e&&(o[(i+1)*e+(n+1)]+=3*s/16),o[(i+1)*e+n]+=5*s/16,n-1>=0&&(o[(i+1)*e+(n-1)]+=1*s/16))}})(t,l,c);const a=new Uint8Array(l*c);for(let e=0;e<a.length;e+=1)i&&t[4*e+3]<128?a[e]=u:a[e]=f([t[4*e],t[4*e+1],t[4*e+2]]);n.writeFrame(a,l,c,{palette:0===e?i?[...s,[0,0,0]]:s:void 0,delay:r,transparent:i,transparentIndex:u})})),n.finish(),e.postMessage(new Blob([n.bytes()],{type:"image/gif"}))}}))})()})();
//# sourceMappingURL=gifworker.js.map